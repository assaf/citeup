generator client {
  provider               = "prisma-client"
  output                 = "generated"
  previewFeatures        = ["postgresqlExtensions"]
  engineType             = "client"
  generatedFileExtension = "ts"
  importFileExtension    = "ts"
  moduleFormat           = "esm"
  runtime                = "nodejs"
}

datasource db {
  provider     = "postgresql"
  relationMode = "foreignKeys"
}

model Account {
  id        String   @id @default(cuid())
  createdAt DateTime @map("created_at") @default(now())
  hostname  String?  @map("hostname")
  users     User[]
  sites     Site[]

  @@map("accounts")
}

model CitationQuery {
  id           String                                 @id @default(cuid())
  createdAt    DateTime         @map("created_at")    @default(now())
  runId        String           @map("run_id")
  run          CitationQueryRun @relation(fields: [runId], references: [id], onDelete: Cascade)
  query        String           @map("query")
  category     String           @map("category")
  repetition   Int              @map("repetition")
  extraQueries String[]         @map("extra_queries")
  text         String           @map("text")
  position     Int?             @map("position")
  citations    String[]         @map("citations")

  @@index([runId])
  @@map("citation_queries")
}

model CitationQueryRun {
  id        String                             @id @default(cuid())
  createdAt DateTime        @map("created_at") @default(now())
  platform  String          @map("platform")
  model     String          @map("model")
  queries   CitationQuery[]
  siteId    String          @map("site_id")
  site      Site            @relation(fields: [siteId], references: [id], onDelete: Cascade)

  @@map("citation_query_runs")
}

model Session {
  id          String                        @id @default(cuid())
  createdAt   DateTime @map("created_at")   @default(now())
  userId      String   @map("user_id")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token       String   @map("token")        @unique
  ipAddress   String?  @map("ip_address")
  userAgent   String?  @map("user_agent")
  referrer    String?  @map("referrer")
  utmSource   String?  @map("utm_source")
  utmMedium   String?  @map("utm_medium")
  utmCampaign String?  @map("utm_campaign")
  utmTerm     String?  @map("utm_term")
  utmContent  String?  @map("utm_content")

  @@index([userId])
  @@map("sessions")
}

model Site {
  id           String                                @id @default(cuid())
  createdAt    DateTime           @map("created_at") @default(now())
  updatedAt    DateTime           @map("updated_at") @updatedAt
  accountId    String             @map("account_id")
  account      Account            @relation(fields: [accountId], references: [id], onDelete: Cascade)
  domain       String             @map("domain")
  content      String?            @map("content")
  citationRuns CitationQueryRun[]

  @@index([accountId])
  @@map("sites")
}

model User {
  id              String                              @id @default(cuid())
  createdAt       DateTime  @map("created_at")        @default(now())
  updatedAt       DateTime  @map("updated_at")        @updatedAt
  accountId       String    @map("account_id")
  account         Account   @relation(fields: [accountId], references: [id], onDelete: Cascade)
  email           String    @map("email")             @unique
  passwordHash    String    @map("password_hash")
  emailVerifiedAt          DateTime?               @map("email_verified_at")
  sessions                  Session[]
  passwordRecoveryTokens    PasswordRecoveryToken[]
  emailVerificationTokens   EmailVerificationToken[]

  @@index([accountId])
  @@map("users")
}

model EmailVerificationToken {
  id        String    @id @default(cuid())
  createdAt DateTime  @map("created_at") @default(now())
  token     String    @unique @map("token")
  userId    String    @map("user_id")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime  @map("expires_at")
  usedAt    DateTime? @map("used_at")

  @@index([userId])
  @@map("email_verification_tokens")
}

model PasswordRecoveryToken {
  id        String    @id @default(cuid())
  createdAt DateTime  @map("created_at") @default(now())
  token     String    @unique @map("token")
  userId    String    @map("user_id")
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime  @map("expires_at")
  usedAt    DateTime? @map("used_at")

  @@index([userId])
  @@map("password_recovery_tokens")
}
